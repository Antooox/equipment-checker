<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stegra – NFC Rentals</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f7fb;
    --panel:#ffffff;
    --text:#111827;
    --muted:#6b7280;
    --line:#e5e7eb;
    --ring:rgba(59,130,246,.35);
    --chip:#fff;
    --chip-border:#e5e7eb;
    --chip-hover:#f9fafb;
    --chip-active:#eef2ff;
    --chip-active-border:#c7d2fe;
    --chip-active-text:#3730a3;
    --success:#22c55e;
    --danger:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",Arial,"Apple Color Emoji","Segoe UI Emoji";
  }
  .shell{max-width:1120px; margin:24px auto; padding:0 16px;}
  header{display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:18px;}
  .brand{font-weight:800; font-size:28px; letter-spacing:.2px}
  .link{color:#2563eb; text-decoration:none; font-weight:600}
  .panel{background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:18px; box-shadow:0 4px 20px rgba(0,0,0,.04)}

  /* Search */
  .search-wrap{margin-bottom:14px}
  .search{
    width:100%; border:1px solid var(--line); background:#fff; border-radius:12px;
    padding:14px 14px; font-size:16px; outline:0;
  }
  .search:focus{box-shadow:0 0 0 3px var(--ring)}

  /* Filters */
  .filters-container{ position:sticky; top:0; z-index:30; padding:8px 0 10px; background:linear-gradient(#f6f7fb 50%, rgba(246,247,251,0)); }
  .filter-bar{ display:flex; flex-wrap:wrap; gap:.75rem; align-items:center; }
  .filter-chip{
    display:inline-flex; align-items:center; gap:.5rem;
    padding:.55rem 1rem; border-radius:9999px;
    border:1px solid var(--chip-border);
    background:var(--chip); color:var(--text);
    box-shadow:0 1px 2px rgba(0,0,0,.04); cursor:pointer; user-select:none;
    font-weight:600;
  }
  .filter-chip:hover{ background:var(--chip-hover); }
  .filter-chip.is-active{ background:var(--chip-active); border-color:var(--chip-active-border); color:var(--chip-active-text); }
  .btn-clear{
    display:inline-flex; align-items:center; gap:.5rem;
    padding:.55rem 1rem; border-radius:9999px; border:1px solid var(--chip-border);
    background:#fff; color:var(--text); font-weight:600; cursor:pointer;
  }
  .btn-clear:hover{ background:var(--chip-hover); }
  .btn{border:1px solid var(--chip-border); background:#fff; padding:.6rem .9rem; border-radius:10px; cursor:pointer; font-weight:600}
  .btn:hover{background:var(--chip-hover)}
  .btn:focus-visible,.filter-chip:focus-visible,.btn-clear:focus-visible{outline:0; box-shadow:0 0 0 3px var(--ring)}

  /* List */
  .grid{ display:grid; gap:14px; }
  @media(min-width:900px){ .grid{ grid-template-columns:1fr 1fr; } }
  .card{
    background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:16px 18px;
    display:flex; align-items:center; justify-content:space-between; gap:14px;
  }
  .left{display:flex; align-items:flex-start; gap:12px; min-width:0}
  .dot{width:10px; height:10px; border-radius:9999px; margin-top:.45rem}
  .dot.green{ background:var(--success); }
  .dot.red{ background:var(--danger); }
  .title{font-weight:800; color:#1d4ed8; margin:0 0 2px; font-size:18px; word-break:break-word}
  .meta{color:var(--muted); font-size:14px}
  .status{font-weight:700; font-size:14px; color:#374151; min-width:96px; text-align:right}
  .tag{color:#6b7280}
  .right{display:flex; align-items:center; gap:10px}
  .small{font-size:12px; color:var(--muted)}
  .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:flex-end; margin:10px 0 6px; }
  .muted{color:var(--muted)}
</style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand">Stegra – NFC Rentals</div>
      <a href="#" class="link">Home</a>
    </header>

    <div class="panel">
      <!-- Search -->
      <div class="search-wrap">
        <input id="search" class="search" placeholder="Search items…" autocomplete="off" />
      </div>

      <!-- Filters -->
      <div class="filters-container">
        <div class="filter-bar" id="filterBar">
          <!-- chips injected by JS -->
          <button class="btn-clear" id="clearFilters" type="button">Clear filters</button>
          <button class="btn" id="exportCsvAll" type="button" title="Download CSV of all loans">Download loans CSV</button>
        </div>
      </div>

      <!-- List Toolbar -->
      <div class="toolbar">
        <span class="small muted" id="resultCount"></span>
      </div>

      <!-- Items -->
      <div class="grid" id="itemsGrid"></div>
    </div>
  </div>

<script>
/* -------------------- Data (example set) -------------------- */
const CATEGORIES = [
  "Vehicles & Lifts",
  "Power Tools",
  "Lighting",
  "Electrical",
  "Batteries & Chargers",
  "Site Equipment"
];

const items = [
  {
    id:"rent-310",
    name:"Boom Lift 16m",
    category:"Vehicles & Lifts",
    rentaId:"RENT-310",
    available:true,
    loanHistory:[
      { itemId:"rent-310", itemName:"Boom Lift 16m", borrowedBy:"Mikael Svensson", borrowedAt:"2025-10-10 08:22", returnedAt:"2025-10-10 16:05" }
    ]
  },
  {
    id:"rent-311",
    name:"Forklift 3.5t",
    category:"Vehicles & Lifts",
    rentaId:"RENT-311",
    available:true,
    loanHistory:[
      { itemId:"rent-311", itemName:"Forklift 3.5t", borrowedBy:"Sara Lind", borrowedAt:"2025-10-12 07:55", returnedAt:"2025-10-12 15:02" }
    ]
  },
  {
    id:"rent-1",
    name:"Scissor Lift 01",
    category:"Vehicles & Lifts",
    rentaId:"RENT-1",
    available:true,
    loanHistory:[]
  },
  {
    id:"rent-202",
    name:"Scissor Lift 02",
    category:"Vehicles & Lifts",
    rentaId:"RENT-202",
    available:false,
    loanHistory:[
      { itemId:"rent-202", itemName:"Scissor Lift 02", borrowedBy:"Jonas Olsson", borrowedAt:"2025-10-22 09:10", returnedAt:"" }
    ]
  },
  {
    id:"pow-77",
    name:"Hilti TE 70-ATC Hammer",
    category:"Power Tools",
    rentaId:"RENT-77",
    available:true,
    loanHistory:[
      { itemId:"pow-77", itemName:"Hilti TE 70-ATC Hammer", borrowedBy:"Ali Reza", borrowedAt:"2025-10-03 11:05", returnedAt:"2025-10-04 08:30" }
    ]
  }
];

/* -------------------- State -------------------- */
let activeCategory = "";  // one-at-a-time filter for simplicity
let searchTerm = "";

/* -------------------- DOM refs -------------------- */
const filterBar = document.getElementById("filterBar");
const itemsGrid = document.getElementById("itemsGrid");
const clearBtn  = document.getElementById("clearFilters");
const searchEl  = document.getElementById("search");
const resultCountEl = document.getElementById("resultCount");
const exportCsvAllBtn = document.getElementById("exportCsvAll");

/* -------------------- Filters UI -------------------- */
function renderChips(){
  // Insert chips before the clear/export buttons
  const beforeNode = document.getElementById("clearFilters");
  CATEGORIES.forEach(cat=>{
    const b = document.createElement("button");
    b.type = "button";
    b.className = "filter-chip";
    b.textContent = cat;
    b.dataset.cat = cat;
    b.addEventListener("click", ()=>{
      // toggle single-select
      if (activeCategory === cat) {
        activeCategory = "";
      } else {
        activeCategory = cat;
      }
      document.querySelectorAll(".filter-chip").forEach(ch=>ch.classList.toggle("is-active", ch.dataset.cat === activeCategory && activeCategory!==""));
      renderList();
    });
    filterBar.insertBefore(b, beforeNode);
  });
}
renderChips();

clearBtn.addEventListener("click", ()=>{
  activeCategory = ""; searchTerm = "";
  document.querySelectorAll(".filter-chip").forEach(b=>b.classList.remove("is-active"));
  searchEl.value = "";
  renderList();
});

searchEl.addEventListener("input", (e)=>{
  searchTerm = (e.target.value || "").trim().toLowerCase();
  renderList();
});

/* -------------------- CSV helpers -------------------- */
function toCsv(rows){
  if (!rows.length) return "";
  const headers = Object.keys(rows[0]);
  const esc = v => `"${String(v ?? "").replace(/"/g,'""')}"`;
  const lines = [
    headers.map(esc).join(","),
    ...rows.map(r => headers.map(h => esc(r[h])).join(","))
  ];
  return lines.join("\n");
}
function download(filename, text){
  const blob = new Blob([text], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

exportCsvAllBtn.addEventListener("click", ()=>{
  const allLoans = items.flatMap(i => i.loanHistory);
  if (!allLoans.length){ alert("No loans to export yet."); return; }
  download("stegrarentals_loans.csv", toCsv(allLoans));
});

/* -------------------- Render list -------------------- */
function matches(item){
  const inCat = !activeCategory || item.category === activeCategory;
  const s = searchTerm;
  if (!s) return inCat;
  const hay = `${item.name} ${item.category} ${item.rentaId}`.toLowerCase();
  return inCat && hay.includes(s);
}

function card(item){
  const el = document.createElement("div");
  el.className = "card";

  const left = document.createElement("div");
  left.className = "left";
  const dot = document.createElement("div");
  dot.className = "dot " + (item.available ? "green" : "red");
  const textWrap = document.createElement("div");

  const title = document.createElement("h3");
  title.className = "title";
  title.textContent = item.name;

  const meta = document.createElement("div");
  meta.className = "meta";
  meta.innerHTML = `<span class="tag">${item.category}</span> · Renta ID: ${item.rentaId}`;

  textWrap.appendChild(title);
  textWrap.appendChild(meta);
  left.appendChild(dot);
  left.appendChild(textWrap);

  const right = document.createElement("div");
  right.className = "right";

  const status = document.createElement("div");
  status.className = "status";
  status.textContent = item.available ? "AVAILABLE" : "OUT";
  right.appendChild(status);

  const csvBtn = document.createElement("button");
  csvBtn.className = "btn";
  csvBtn.type = "button";
  csvBtn.textContent = "Loans CSV";
  csvBtn.title = "Download CSV for this item";
  csvBtn.addEventListener("click", ()=>{
    if (!item.loanHistory.length){ alert("No loans to export for this item."); return; }
    download(`loans_${item.id}.csv`, toCsv(item.loanHistory));
  });
  right.appendChild(csvBtn);

  el.appendChild(left);
  el.appendChild(right);
  return el;
}

function renderList(){
  itemsGrid.innerHTML = "";
  const list = items.filter(matches);
  list.forEach(i => itemsGrid.appendChild(card(i)));
  resultCountEl.textContent = `${list.length} item${list.length===1?"":"s"} shown`;
}
renderList();

/* -------------------- (OPTIONAL) integrate with Supabase later --------------------
   - Replace the static 'items' with data from your DB.
   - Keep same field names for drop-in rendering, or map to them.
------------------------------------------------------------------------------- */
</script>
</body>
</html>
